{% extends "base.html" %}
{% block title %}AI Dashboard - YuVA Wellness{% endblock %}

{% block extra_head %}
<script src="/components/dashboard/ai-widgets.js" defer></script>
<style>
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
}

.ai-widget {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-lg);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.ai-widget::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary-gradient);
    transform: scaleX(0);
    transition: var(--transition);
}

.ai-widget:hover::before {
    transform: scaleX(1);
}

.ai-widget:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
}

.widget-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
}

.widget-icon {
    font-size: 1.5rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.widget-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-primary);
}

.widget-content {
    color: var(--text-secondary);
    line-height: 1.6;
}

.loading-widget {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100px;
    color: var(--text-muted);
}

.insight-card {
    background: var(--bg-secondary);
    border-radius: var(--border-radius);
    padding: var(--spacing-md);
    margin: var(--spacing-sm) 0;
    border-left: 4px solid var(--primary);
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-secondary);
    border-radius: 4px;
    overflow: hidden;
    margin: var(--spacing-sm) 0;
}

.progress-fill {
    height: 100%;
    background: var(--primary-gradient);
    transition: width 1s ease;
}

.action-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    background: var(--bg-secondary);
    border-radius: var(--border-radius);
    margin: var(--spacing-xs) 0;
    transition: var(--transition);
}

.action-item:hover {
    background: var(--bg-tertiary);
    transform: translateX(5px);
}

.action-icon {
    font-size: 1.2rem;
}

.refresh-btn {
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: var(--border-radius);
    transition: var(--transition);
}

.refresh-btn:hover {
    color: var(--primary);
    background: var(--bg-secondary);
}

.affirmation-text {
    font-size: 1.1rem;
    font-style: italic;
    color: var(--text-primary);
    text-align: center;
    padding: var(--spacing-lg);
    background: var(--bg-secondary);
    border-radius: var(--border-radius);
    border-left: 4px solid var(--success);
}

.exercise-steps {
    background: var(--bg-secondary);
    padding: var(--spacing-md);
    border-radius: var(--border-radius);
    margin: var(--spacing-sm) 0;
}

/* Quick AI Actions Button Styles */
.btn-analyze-journal {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
    transition: var(--transition);
}

.btn-analyze-journal:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
}

.btn-wellness-plan {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
    transition: var(--transition);
}

.btn-wellness-plan:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
}

.btn-mindfulness {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
    transition: var(--transition);
}

.btn-mindfulness:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
}

.btn-wellness-starters {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    color: #2d3748;
    border: none;
    box-shadow: 0 4px 15px rgba(252, 182, 159, 0.3);
    transition: var(--transition);
}

.btn-wellness-starters:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 25px rgba(252, 182, 159, 0.4);
}

@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="page-header" style="text-align: center; margin-bottom: var(--spacing-xl);">
    <h1 style="font-size: 2.5rem; margin-bottom: var(--spacing-sm); background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
        <i class="fas fa-brain"></i> AI Wellness Dashboard
    </h1>
    <p style="color: var(--text-secondary); font-size: 1.1rem;">
        Your personalized AI-powered insights and recommendations for better mental wellness
    </p>
</div>

<div class="dashboard-grid">
    <!-- Daily Insights Widget -->
    <div class="ai-widget" id="daily-insights-widget">
        <button class="refresh-btn" onclick="refreshWidget('daily-insights')">
            <i class="fas fa-sync-alt"></i>
        </button>
        <div class="widget-header">
            <span class="widget-icon">üß†</span>
            <h3 class="widget-title">Daily AI Insights</h3>
        </div>
        <div class="widget-content" id="daily-insights-content">
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Generating personalized insights...
            </div>
        </div>
    </div>

    <!-- Progress Summary Widget -->
    <div class="ai-widget" id="progress-widget">
        <button class="refresh-btn" onclick="refreshWidget('progress')">
            <i class="fas fa-sync-alt"></i>
        </button>
        <div class="widget-header">
            <span class="widget-icon">üìà</span>
            <h3 class="widget-title">Your Progress</h3>
        </div>
        <div class="widget-content" id="progress-content">
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Analyzing your progress...
            </div>
        </div>
    </div>

    <!-- Daily Affirmation Widget -->
    <div class="ai-widget" id="affirmation-widget">
        <button class="refresh-btn" onclick="refreshWidget('affirmation')">
            <i class="fas fa-sync-alt"></i>
        </button>
        <div class="widget-header">
            <span class="widget-icon">üí´</span>
            <h3 class="widget-title">Daily Affirmation</h3>
        </div>
        <div class="widget-content" id="affirmation-content">
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Creating your affirmation...
            </div>
        </div>
    </div>

    <!-- Wellness Tip Widget -->
    <div class="ai-widget" id="wellness-tip-widget">
        <button class="refresh-btn" onclick="refreshWidget('wellness-tip')">
            <i class="fas fa-sync-alt"></i>
        </button>
        <div class="widget-header">
            <span class="widget-icon">üí°</span>
            <h3 class="widget-title">Wellness Tip</h3>
        </div>
        <div class="widget-content" id="wellness-tip-content">
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Generating wellness tip...
            </div>
        </div>
    </div>

    <!-- Mindfulness Exercise Widget -->
    <div class="ai-widget" id="mindfulness-widget">
        <button class="refresh-btn" onclick="refreshWidget('mindfulness')">
            <i class="fas fa-sync-alt"></i>
        </button>
        <div class="widget-header">
            <span class="widget-icon">üßò</span>
            <h3 class="widget-title">Mindfulness Exercise</h3>
        </div>
        <div class="widget-content" id="mindfulness-content">
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Preparing mindfulness exercise...
            </div>
        </div>
    </div>

    <!-- Smart Suggestions Widget -->
    <div class="ai-widget" id="suggestions-widget">
        <button class="refresh-btn" onclick="refreshWidget('suggestions')">
            <i class="fas fa-sync-alt"></i>
        </button>
        <div class="widget-header">
            <span class="widget-icon">üéØ</span>
            <h3 class="widget-title">Smart Suggestions</h3>
        </div>
        <div class="widget-content" id="suggestions-content">
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Analyzing patterns for suggestions...
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card" style="margin-top: var(--spacing-xl);">
    <h3 style="margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm); color: var(--text-primary);">
        <i class="fas fa-bolt" style="color: var(--primary);"></i>
        Quick AI Actions
    </h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
        <button class="btn btn-analyze-journal" onclick="analyzeJournal()">
            <i class="fas fa-search"></i> Analyze Journal
        </button>
        <button class="btn btn-wellness-plan" onclick="getWellnessPlan()">
            <i class="fas fa-clipboard-list"></i> Get Wellness Plan
        </button>
        <button class="btn btn-mindfulness" onclick="startMindfulness()">
            <i class="fas fa-leaf"></i> Start Mindfulness
        </button>
        <button class="btn btn-wellness-starters" onclick="getWellnessStarters()">
            <i class="fas fa-comments"></i> Wellness Starters
        </button>
    </div>
</div>

<script>
// Initialize dashboard using components
document.addEventListener('DOMContentLoaded', () => {
    // Try to load AI widgets, but fall back to demo content if it fails
    if (typeof AIDashboardWidgets !== 'undefined') {
        try {
            new AIDashboardWidgets();
        } catch (error) {
            console.error('AI widgets failed to load:', error);
            setTimeout(loadDemoContent, 500);
        }
    } else {
        // Load demo content if component not available
        setTimeout(loadDemoContent, 500);
    }
});

// Load demo content for widgets
function loadDemoContent() {
    // Daily Insights
    document.getElementById('daily-insights-content').innerHTML = `
        <div class="insight-card">
            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">üß† Mood Pattern</h4>
            <p style="color: var(--text-secondary); margin: 0;">Your mood has been consistently positive over the past 3 days. Keep up the great work!</p>
        </div>
        <div class="insight-card">
            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">üìà Progress Update</h4>
            <p style="color: var(--text-secondary); margin: 0;">You're 85% towards your weekly wellness goal. Just 2 more journal entries to go!</p>
        </div>
    `;
    
    // Progress
    document.getElementById('progress-content').innerHTML = `
        <div style="margin-bottom: var(--spacing-md);">
            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs); color: var(--text-primary); font-weight: 600;">
                <span>Weekly Goal</span>
                <span>85%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 85%"></div>
            </div>
        </div>
        <div style="margin-bottom: var(--spacing-md);">
            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs); color: var(--text-primary); font-weight: 600;">
                <span>Mindfulness Streak</span>
                <span>7 days</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 70%"></div>
            </div>
        </div>
    `;
    
    // Affirmation
    document.getElementById('affirmation-content').innerHTML = `
        <div class="affirmation-text">
            "I am capable of handling whatever challenges come my way today. My mental health matters, and I choose to prioritize my wellbeing."
        </div>
    `;
    
    // Wellness Tip
    document.getElementById('wellness-tip-content').innerHTML = `
        <div class="insight-card">
            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">üí° Today's Tip: Deep Breathing</h4>
            <p style="color: var(--text-secondary); margin: 0;">Try the 4-7-8 breathing technique: Inhale for 4 counts, hold for 7, exhale for 8. This activates your body's relaxation response.</p>
        </div>
    `;
    
    // Mindfulness
    document.getElementById('mindfulness-content').innerHTML = `
        <div class="exercise-steps">
            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">üßò 5-Minute Body Scan</h4>
            <p style="color: var(--text-secondary); margin: 0;">Take a moment to scan your body from head to toe. Notice any areas of tension and consciously relax them.</p>
        </div>
    `;
    
    // Suggestions
    document.getElementById('suggestions-content').innerHTML = `
        <div class="action-item">
            <span class="action-icon">üéØ</span>
            <div>
                <div style="color: var(--text-primary); font-weight: 600;">Take a 10-minute walk</div>
                <div style="color: var(--text-secondary); font-size: 0.9rem;">Based on your recent mood patterns</div>
            </div>
        </div>
        <div class="action-item">
            <span class="action-icon">üìö</span>
            <div>
                <div style="color: var(--text-primary); font-weight: 600;">Try guided meditation</div>
                <div style="color: var(--text-secondary); font-size: 0.9rem;">Check out our Resources section</div>
            </div>
        </div>
    `;
}

// Widget refresh functions
function refreshWidget(widgetType) {
    const content = document.getElementById(widgetType + '-content');
    if (content) {
        content.innerHTML = `
            <div class="loading-widget">
                <i class="fas fa-spinner fa-spin"></i> Refreshing ${widgetType}...
            </div>
        `;
        
        // Reload content after delay
        setTimeout(() => {
            loadDemoContent();
        }, 1500);
    }
}

// Action functions - All working and intact
function analyzeJournal() {
    const text = prompt("üìù Enter some text from your journal to analyze:");
    if (text && text.trim()) {
        const analysis = analyzeTextSentiment(text);
        const resultDisplay = `üìä Journal Analysis Results

üé≠ Sentiment: ${analysis.sentiment}
üí≠ Emotional Tone: ${analysis.tone}
üîç Key Themes: ${analysis.themes}

‚ú® Insight: ${analysis.insight}

This analysis helps you understand the emotional patterns in your writing.`;
        
        alert(resultDisplay);
    }
}

function getWellnessPlan() {
    const plans = [
        {
            daily: [
                "Practice 5 minutes of deep breathing",
                "Write 3 things you're grateful for",
                "Take a 15-minute mindful walk",
                "Do a quick body scan meditation"
            ],
            weekly: [
                "Complete mood tracking 5 days",
                "Try one new wellness activity",
                "Connect with a friend or family member",
                "Review and reflect on your progress"
            ]
        }
    ];
    
    const selectedPlan = plans[0];
    
    const planDisplay = `üéØ Your Personalized Wellness Plan

üìÖ Daily Goals:
${selectedPlan.daily.map(goal => `‚Ä¢ ${goal}`).join('\n')}

üìä Weekly Goals:
${selectedPlan.weekly.map(goal => `‚Ä¢ ${goal}`).join('\n')}

üí° This plan is tailored to support your mental wellness journey.`;
    
    alert(planDisplay);
}

function startMindfulness() {
    createMindfulnessModal();
}

function createMindfulnessModal() {
    // Remove existing modal if present
    const existingModal = document.getElementById('mindfulness-modal');
    if (existingModal) {
        existingModal.remove();
    }
    
    const exercises = [
        {
            title: "ü´Å 4-7-8 Breathing Technique",
            description: "A powerful breathing method used by Navy SEALs to instantly calm the nervous system and reduce anxiety.",
            instructions: [
                "Sit comfortably and close your eyes",
                "Inhale through your nose for 4 counts",
                "Hold your breath for 7 counts", 
                "Exhale through your mouth for 8 counts",
                "Repeat 4-6 cycles"
            ],
            benefits: "Reduces stress, lowers heart rate, improves sleep quality",
            duration: "3-5 minutes",
            difficulty: "Beginner",
            color: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
        },
        {
            title: "üßò‚Äç‚ôÄÔ∏è Progressive Body Scan",
            description: "A journey through your body to release tension and achieve deep relaxation, practiced by millions worldwide.",
            instructions: [
                "Lie down or sit comfortably",
                "Close your eyes and take 3 deep breaths",
                "Start with your toes - notice any sensations",
                "Slowly move up: feet ‚Üí legs ‚Üí hips ‚Üí torso ‚Üí arms ‚Üí neck ‚Üí head",
                "Spend 30 seconds on each body part",
                "Consciously relax each area as you focus on it"
            ],
            benefits: "Reduces muscle tension, improves body awareness, promotes deep relaxation",
            duration: "8-15 minutes",
            difficulty: "Intermediate",
            color: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
        },
        {
            title: "üå± 5-4-3-2-1 Grounding Technique",
            description: "An evidence-based method to anchor yourself in the present moment, especially helpful during anxiety or panic.",
            instructions: [
                "Look around and identify:",
                "5 things you can SEE (colors, shapes, objects)",
                "4 things you can TOUCH (textures, temperatures)",
                "3 things you can HEAR (sounds near and far)",
                "2 things you can SMELL (scents in the air)",
                "1 thing you can TASTE (current taste in mouth)"
            ],
            benefits: "Stops racing thoughts, reduces anxiety, increases present-moment awareness",
            duration: "3-7 minutes",
            difficulty: "Beginner",
            color: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
        },
        {
            title: "üíù Loving-Kindness Meditation",
            description: "An ancient Buddhist practice that cultivates compassion and reduces negative emotions toward yourself and others.",
            instructions: [
                "Sit quietly and breathe naturally",
                "Start with yourself: 'May I be happy, healthy, safe, and at peace'",
                "Think of a loved one: 'May you be happy, healthy, safe, and at peace'",
                "Think of a neutral person: 'May you be happy, healthy, safe, and at peace'",
                "Think of someone difficult: 'May you be happy, healthy, safe, and at peace'",
                "Extend to all beings: 'May all beings be happy, healthy, safe, and at peace'"
            ],
            benefits: "Increases empathy, reduces self-criticism, improves relationships",
            duration: "10-20 minutes",
            difficulty: "Intermediate",
            color: "linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)"
        },
        {
            title: "üåä Mindful Ocean Breathing",
            description: "Visualize your breath as gentle ocean waves, creating a sense of calm and rhythm like being by the sea.",
            instructions: [
                "Sit or lie down comfortably",
                "Close your eyes and imagine you're by the ocean",
                "As you inhale, visualize a wave slowly approaching the shore",
                "As you exhale, see the wave gently retreating",
                "Match your breathing to this natural rhythm",
                "If your mind wanders, return to the ocean waves"
            ],
            benefits: "Calms the mind, reduces stress, improves focus and concentration",
            duration: "5-10 minutes",
            difficulty: "Beginner",
            color: "linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"
        },
        {
            title: "üéØ Mindful Observation",
            description: "Train your attention by deeply observing a single object, enhancing focus and present-moment awareness.",
            instructions: [
                "Choose an object nearby (flower, candle, stone, etc.)",
                "Sit comfortably and hold or place the object in front of you",
                "Observe it as if seeing it for the first time",
                "Notice colors, textures, shapes, shadows, reflections",
                "When your mind wanders, gently return to the object",
                "Try to see new details you hadn't noticed before"
            ],
            benefits: "Improves concentration, enhances mindfulness, reduces mental chatter",
            duration: "5-8 minutes",
            difficulty: "Beginner",
            color: "linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%)"
        }
    ];
    
    const randomExercise = exercises[Math.floor(Math.random() * exercises.length)];
    
    const difficultyEmoji = {
        "Beginner": "üü¢",
        "Intermediate": "üü°",
        "Advanced": "üî¥"
    };
    
    // Create modal HTML
    const modal = document.createElement('div');
    modal.id = 'mindfulness-modal';
    modal.innerHTML = `
        <div class="mindfulness-overlay" onclick="closeMindfulnessModal()">
            <div class="mindfulness-container" onclick="event.stopPropagation()">
                <div class="mindfulness-header" style="background: ${randomExercise.color};">
                    <div class="header-content">
                        <h2>‚ú® MINDFULNESS EXPERIENCE ‚ú®</h2>
                        <button class="close-btn" onclick="closeMindfulnessModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mindfulness-content">
                    <div class="exercise-title">
                        <h3>${randomExercise.title}</h3>
                        <div class="exercise-meta">
                            <span class="duration">‚è±Ô∏è ${randomExercise.duration}</span>
                            <span class="difficulty">${difficultyEmoji[randomExercise.difficulty]} ${randomExercise.difficulty}</span>
                        </div>
                    </div>
                    
                    <div class="exercise-description">
                        <h4>üìñ About This Practice</h4>
                        <p>${randomExercise.description}</p>
                    </div>
                    
                    <div class="exercise-instructions">
                        <h4>üéØ Step-by-Step Guide</h4>
                        <ul>
                            ${randomExercise.instructions.map(step => `<li>${step}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="exercise-benefits">
                        <h4>üí´ Benefits</h4>
                        <p>${randomExercise.benefits}</p>
                    </div>
                    
                    <div class="exercise-actions">
                        <button class="btn-start-practice" onclick="startPractice()">
                            <i class="fas fa-play"></i> Start Practice
                        </button>
                        <button class="btn-try-another" onclick="createMindfulnessModal()">
                            <i class="fas fa-random"></i> Try Another Exercise
                        </button>
                        <button class="btn-close" onclick="closeMindfulnessModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Add modal styles
    addMindfulnessStyles();
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
}

function addMindfulnessStyles() {
    if (document.getElementById('mindfulness-modal-styles')) return;
    
    const style = document.createElement('style');
    style.id = 'mindfulness-modal-styles';
    style.textContent = `
        .mindfulness-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .mindfulness-container {
            background: var(--bg-card);
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
            animation: slideIn 0.4s ease-out;
            border: 1px solid var(--border-color);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .mindfulness-header {
            padding: 2rem;
            border-radius: 20px 20px 0 0;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .mindfulness-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            opacity: 0.9;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mindfulness-header h2 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .mindfulness-content {
            padding: 2rem;
            color: var(--text-primary);
        }
        
        .exercise-title {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .exercise-title h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .exercise-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }
        
        .duration, .difficulty {
            background: var(--bg-secondary);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .exercise-description,
        .exercise-instructions,
        .exercise-benefits {
            margin-bottom: 2rem;
        }
        
        .exercise-description h4,
        .exercise-instructions h4,
        .exercise-benefits h4 {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .exercise-description p,
        .exercise-benefits p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 1rem;
        }
        
        .exercise-instructions ul {
            list-style: none;
            padding: 0;
        }
        
        .exercise-instructions li {
            background: var(--bg-secondary);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        
        .exercise-instructions li:hover {
            background: var(--bg-tertiary);
            transform: translateX(5px);
        }
        
        .exercise-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .btn-start-practice {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-start-practice:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
        }
        
        .btn-try-another {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-try-another:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-close {
            background: transparent;
            color: var(--text-muted);
            border: 2px solid var(--border-color);
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-close:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .mindfulness-container {
                width: 95%;
                margin: 1rem;
                max-height: 95vh;
            }
            
            .mindfulness-header {
                padding: 1.5rem;
            }
            
            .mindfulness-header h2 {
                font-size: 1.5rem;
            }
            
            .mindfulness-content {
                padding: 1.5rem;
            }
            
            .exercise-meta {
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }
            
            .exercise-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-start-practice,
            .btn-try-another,
            .btn-close {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
    `;
    
    document.head.appendChild(style);
}

function closeMindfulnessModal() {
    const modal = document.getElementById('mindfulness-modal');
    if (modal) {
        modal.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => {
            modal.remove();
            document.body.style.overflow = 'auto';
        }, 300);
    }
}

function startPractice() {
    // Get the current exercise data from the modal
    const modal = document.getElementById('mindfulness-modal');
    const exerciseTitle = modal.querySelector('.exercise-title h3').textContent;
    const instructions = Array.from(modal.querySelectorAll('.exercise-instructions li')).map(li => li.textContent);
    
    // Close the modal first
    closeMindfulnessModal();
    
    // Create a practice session interface
    createPracticeSession(exerciseTitle, instructions);
}

function createPracticeSession(title, instructions) {
    // Remove any existing practice session
    const existingSession = document.getElementById('practice-session');
    if (existingSession) {
        existingSession.remove();
    }
    
    const session = document.createElement('div');
    session.id = 'practice-session';
    session.innerHTML = `
        <div class="practice-overlay">
            <div class="practice-container">
                <div class="practice-header">
                    <h2>üßò ${title}</h2>
                    <button class="practice-close-btn" onclick="closePracticeSession()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="practice-content">
                    <div class="practice-timer">
                        <div class="timer-display">
                            <span id="timer-minutes">05</span>:<span id="timer-seconds">00</span>
                        </div>
                        <div class="timer-controls">
                            <button id="start-timer-btn" onclick="startTimer()">
                                <i class="fas fa-play"></i> Start
                            </button>
                            <button id="pause-timer-btn" onclick="pauseTimer()" style="display: none;">
                                <i class="fas fa-pause"></i> Pause
                            </button>
                            <button id="reset-timer-btn" onclick="resetTimer()">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                    </div>
                    
                    <div class="practice-instructions">
                        <h4>üéØ Follow These Steps:</h4>
                        <div class="instruction-steps">
                            ${instructions.map((instruction, index) => `
                                <div class="instruction-step" data-step="${index + 1}">
                                    <span class="step-number">${index + 1}</span>
                                    <span class="step-text">${instruction}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="practice-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="practice-progress-fill" style="width: 0%"></div>
                        </div>
                        <p class="progress-text">Click Start to begin your practice session</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Add practice session styles
    addPracticeSessionStyles();
    document.body.appendChild(session);
    document.body.style.overflow = 'hidden';
}

function addPracticeSessionStyles() {
    if (document.getElementById('practice-session-styles')) return;
    
    const style = document.createElement('style');
    style.id = 'practice-session-styles';
    style.textContent = `
        .practice-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease-out;
        }
        
        .practice-container {
            background: var(--bg-card);
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
            animation: slideIn 0.4s ease-out;
            border: 1px solid var(--border-color);
        }
        
        .practice-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 2rem;
            border-radius: 20px 20px 0 0;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .practice-header h2 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .practice-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .practice-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .practice-content {
            padding: 2rem;
        }
        
        .practice-timer {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 15px;
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
        }
        
        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .timer-controls button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #start-timer-btn {
            background: linear-gradient(135deg, var(--success), #00b894);
            color: white;
        }
        
        #pause-timer-btn {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
        }
        
        #reset-timer-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .timer-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .practice-instructions {
            margin-bottom: 2rem;
        }
        
        .practice-instructions h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .instruction-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .instruction-step:hover {
            background: var(--bg-tertiary);
            transform: translateX(5px);
        }
        
        .step-number {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .step-text {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .practice-progress {
            text-align: center;
        }
        
        .progress-text {
            color: var(--text-muted);
            margin-top: 1rem;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .practice-container {
                width: 95%;
                margin: 1rem;
            }
            
            .practice-header {
                padding: 1.5rem;
            }
            
            .practice-content {
                padding: 1.5rem;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .timer-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .timer-controls button {
                width: 100%;
                max-width: 200px;
                justify-content: center;
            }
        }
    `;
    
    document.head.appendChild(style);
}

let practiceTimer = null;
let practiceTimeLeft = 300; // 5 minutes in seconds
let isPaused = false;

function startTimer() {
    const startBtn = document.getElementById('start-timer-btn');
    const pauseBtn = document.getElementById('pause-timer-btn');
    const progressText = document.querySelector('.progress-text');
    
    startBtn.style.display = 'none';
    pauseBtn.style.display = 'flex';
    progressText.textContent = 'Practice session in progress... Focus on your breathing';
    
    isPaused = false;
    
    practiceTimer = setInterval(() => {
        if (!isPaused && practiceTimeLeft > 0) {
            practiceTimeLeft--;
            updateTimerDisplay();
            updateProgress();
            
            if (practiceTimeLeft === 0) {
                completePractice();
            }
        }
    }, 1000);
}

function pauseTimer() {
    const startBtn = document.getElementById('start-timer-btn');
    const pauseBtn = document.getElementById('pause-timer-btn');
    const progressText = document.querySelector('.progress-text');
    
    isPaused = true;
    startBtn.style.display = 'flex';
    pauseBtn.style.display = 'none';
    progressText.textContent = 'Practice paused. Click Start to continue';
}

function resetTimer() {
    if (practiceTimer) {
        clearInterval(practiceTimer);
        practiceTimer = null;
    }
    
    practiceTimeLeft = 300;
    isPaused = false;
    
    const startBtn = document.getElementById('start-timer-btn');
    const pauseBtn = document.getElementById('pause-timer-btn');
    const progressText = document.querySelector('.progress-text');
    
    startBtn.style.display = 'flex';
    pauseBtn.style.display = 'none';
    progressText.textContent = 'Click Start to begin your practice session';
    
    updateTimerDisplay();
    updateProgress();
}

function updateTimerDisplay() {
    const minutes = Math.floor(practiceTimeLeft / 60);
    const seconds = practiceTimeLeft % 60;
    
    document.getElementById('timer-minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('timer-seconds').textContent = seconds.toString().padStart(2, '0');
}

function updateProgress() {
    const totalTime = 300; // 5 minutes
    const progress = ((totalTime - practiceTimeLeft) / totalTime) * 100;
    document.getElementById('practice-progress-fill').style.width = `${progress}%`;
}

function completePractice() {
    if (practiceTimer) {
        clearInterval(practiceTimer);
        practiceTimer = null;
    }
    
    const progressText = document.querySelector('.progress-text');
    progressText.textContent = 'üéâ Practice complete! Well done on taking time for your wellness.';
    
    // Show completion message
    setTimeout(() => {
        alert('üßò Practice Complete!\n\n‚ú® Congratulations on completing your mindfulness session! You\'ve taken an important step for your mental wellness.\n\nüí´ How do you feel? Take a moment to notice any changes in your body and mind.');
    }, 1000);
}

function closePracticeSession() {
    if (practiceTimer) {
        clearInterval(practiceTimer);
        practiceTimer = null;
    }
    
    const session = document.getElementById('practice-session');
    if (session) {
        session.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => {
            session.remove();
            document.body.style.overflow = 'auto';
        }, 300);
    }
}

function getWellnessStarters() {
    const starters = `üí¨ Wellness Assessment Starters

1. How are you feeling emotionally today?
2. What's been on your mind lately?
3. How well have you been sleeping?
4. What activities bring you joy?
5. How do you typically handle stress?

üí° Use these prompts to start your wellness assessment journey.

üß† Ready to begin?`;
    
    if (confirm(starters + '\n\nWould you like to go to the Wellness Assessment page now?')) {
        window.location.href = '/wellness';
    }
}

// Helper function for journal analysis
function analyzeTextSentiment(text) {
    const positiveWords = ['happy', 'joy', 'love', 'excited', 'grateful', 'amazing', 'wonderful', 'great', 'good', 'positive'];
    const negativeWords = ['sad', 'angry', 'frustrated', 'worried', 'anxious', 'depressed', 'terrible', 'awful', 'bad', 'negative'];
    
    const words = text.toLowerCase().split(/\s+/);
    let positiveCount = 0;
    let negativeCount = 0;
    
    words.forEach(word => {
        if (positiveWords.some(pw => word.includes(pw))) positiveCount++;
        else if (negativeWords.some(nw => word.includes(nw))) negativeCount++;
    });
    
    let sentiment, tone, insight;
    
    if (positiveCount > negativeCount) {
        sentiment = "Positive";
        tone = "Optimistic and uplifting";
        insight = "Your writing reflects a positive mindset. This is great for your mental wellbeing!";
    } else if (negativeCount > positiveCount) {
        sentiment = "Negative";
        tone = "Reflective with some challenges";
        insight = "Your writing shows you're processing some difficulties. Consider reaching out for support if needed.";
    } else {
        sentiment = "Neutral";
        tone = "Balanced and thoughtful";
        insight = "Your writing shows a balanced perspective. This suggests good emotional regulation.";
    }
    
    const themes = "Self-reflection, daily experiences, emotional processing";
    
    return { sentiment, tone, themes, insight };
}
</script>

{% endblock %}